{% extends 'accounts/base.html' %}
{% load static %}

{% block title %}تسجيل الدخول - منصتي الطبية{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'accounts/css/loader.css' %}">
{% endblock %}

{% block content %}
<section class="auth-wrapper">
    <div class="container" style="display: flex; justify-content: center;">
        <div class="auth-card reveal-on-scroll" id="loginCard">
            <div class="auth-header">
                <h2 class="text-h2">مرحباً بعودتك</h2>
                <p class="text-body-m text-muted">سجل الدخول للمتابعة إلى حسابك</p>
            </div>

            <form method="post" id="loginForm">
                {% csrf_token %}

                <div class="form-group">
                    <label for="phone">رقم الهاتف</label>
                    <input type="text" id="phone" name="phone" placeholder="05XXXXXXXX" required dir="ltr"
                        style="text-align: right;">
                    {% if form.phone.errors %}
                    <ul class="errorlist">
                        {% for error in form.phone.errors %}
                        <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="password">كلمة المرور</label>
                    <input type="password" id="password" name="password" required>
                    {% if form.password.errors %}
                    <ul class="errorlist">
                        {% for error in form.password.errors %}
                        <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">تسجيل الدخول</button>
            </form>

            <div class="text-center" style="margin-top: 1.5rem;">
                <p class="text-body-m">ليس لديك حساب؟ <a href="{% url 'accounts:register' %}" class="text-primary"
                        style="font-weight: 600;">أنشئ حساباً جديداً</a></p>
            </div>

            <div
                style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-default, #e2e8f0); text-align: center;">
                <a href="{% url 'accounts:forgot_password_phone' %}"
                    style="color: var(--text-muted, #718096); font-size: 0.9rem; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; transition: color 0.2s;"
                    onmouseover="this.style.color='var(--primary, #667eea)'"
                    onmouseout="this.style.color='var(--text-muted, #718096)'">
                    <i class="fa-solid fa-key" style="font-size: 0.85rem;"></i>
                    نسيت كلمة المرور؟
                </a>
            </div>

            <!-- Heartbeat Medical Loader -->
            {% include 'accounts/_heartbeat_loader.html' with overlay_id='loginOverlay' loader_text='جارٍ تسجيل الدخول' loader_icon='fa-stethoscope' %}
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    (function () {
        var form = document.getElementById('loginForm');
        var overlay = document.getElementById('loginOverlay');
        if (!form || !overlay) return;

        var submitted = false;

        form.addEventListener('submit', function (e) {
            if (submitted) { e.preventDefault(); return; }
            submitted = true;
            overlay.style.display = 'flex';
        });
    })();
</script>
{% endblock %}