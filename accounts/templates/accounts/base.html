{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="light">

<head>
    <meta charset="UTF-8">
    <script>
        document.documentElement.classList.add('js');
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}منصتي الطبية{% endblock %}</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'accounts/css/landing.css' %}">
    <link rel="stylesheet" href="{% static 'accounts/css/loader.css' %}">
    {% block extra_css %}{% endblock %}
</head>

<body>
    <!-- Page Transition: Top Bar -->
    <div class="page-transition-bar" id="ptBar">
        <div class="page-transition-bar-fill"></div>
    </div>

    <!-- Page Transition: Skeleton Overlay -->
    <div class="page-transition-skeleton skel-layout-auth" id="ptSkeleton">
        <div class="skel-nav"></div>
        <div class="skel-auth-card">
            <div class="skel-icon-circle skel-shape"></div>
            <div class="skel-h-center skel-shape"></div>
            <div class="skel-p-center skel-shape"></div>
            <div class="skel-input skel-shape"></div>
            <div class="skel-input skel-shape"></div>
            <div class="skel-btn-block skel-shape"></div>
        </div>
    </div>

    <!-- Navbar -->
    {% include 'accounts/navbar.html' %}

    <!-- Main Content -->
    <main style="min-height: 80vh;">
        <!-- Messages -->
        {% block messages %}
        <div class="container" style="margin-top: 2rem;">
            {% if messages %}
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} reveal-on-scroll">
                {% if message.tags == 'success' %}
                <i class="fa-solid fa-check-circle"></i>
                {% elif message.tags == 'error' %}
                <i class="fa-solid fa-circle-exclamation"></i>
                {% elif message.tags == 'info' %}
                <i class="fa-solid fa-circle-info"></i>
                {% endif %}
                {{ message }}
            </div>
            {% endfor %}
            {% endif %}
        </div>
        {% endblock %}

        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    {% include 'accounts/footer.html' %}

    <!-- Scripts -->
    <script src="{% static 'accounts/js/landing.js' %}"></script>
    <script>
        (function () {
            var bar = document.getElementById('ptBar');
            var skel = document.getElementById('ptSkeleton');
            if (!bar || !skel) return;

            document.addEventListener('click', function (e) {
                var link = e.target.closest('a');
                if (!link) return;
                
                // Don't trigger if navigation is prevented by other scripts
                if (e.defaultPrevented) return;

                // Don't trigger on modifier keys (new tab/window)
                if (e.ctrlKey || e.metaKey || e.shiftKey || e.altKey) return;

                var href = link.getAttribute('href');
                if (!href || href.startsWith('#') || href.startsWith('javascript:') || href.startsWith('mailto:') || href.startsWith('tel:') || link.target === '_blank') return;
                
                if (link.hasAttribute('download')) return;

                // Check for same-page hash links (anchors) even if absolute path
                try {
                    var targetUrl = new URL(link.href, window.location.origin);
                    var currentUrl = new URL(window.location.href);
                    if (targetUrl.pathname === currentUrl.pathname && 
                        targetUrl.search === currentUrl.search && 
                        targetUrl.hash) {
                        return;
                    }
                } catch (err) {
                    // unexpected url format
                }

                bar.classList.add('active');
                skel.classList.add('active');
            });

            window.addEventListener('pageshow', function (e) {
                bar.classList.remove('active');
                skel.classList.remove('active');
            });

            // Safety: Force hide on load to prevent stuck loader
            window.addEventListener('load', function() {
                setTimeout(function() {
                    bar.classList.remove('active');
                    skel.classList.remove('active');
                }, 100);
            });
        })();
    </script>
    <script src="{% static 'accounts/js/reveal.js' %}" defer></script>
    {% block extra_js %}{% endblock %}
</body>

</html>